<h2>Description</h2>

<p>cl-bencode is a Common Lisp bencode library.  Bencode is the encoding
used by BitTorrent.</p>

<h2>Features</h2>

<p>cl-bencode supports all four different types of bencode values.</p>

<ul>
<li>byte strings as strings or byte vectors</li>
<li>integers as integers</li>
<li>lists as lists</li>
<li>and dictionaries as hashtables</li>
</ul>

<p>It&apos;s proven capable of roundtripping several torrents found in the
wild.</p>

<h2>String encoding</h2>

<p>The bencode specification does not deal with character
encodings. cl-bencode uses flexi-streams&apos; external-formats for
character encoding.  The default is UTF-8.  See
http://weitz.de/flexi-streams/#external-formats</p>

<h2>Binary strings</h2>

<p>The parameter *binary-key-p* may hold a function. When decoding
dictionary values, this function is passed a list, where the first
element is the key of the value. If the dictionary was in turn a
dictionary value, that key is the second element of the list, and so
on. Should a dictionary be a value in a bencoded list, the
corresponding element in the list will be the symbol :list.  When the
function return a true value, the dictionary value will be
binary. Otherwise it will be decoded as a string.</p>

<p>The default function in *binary-key-p* returns true for the &ldquo;pieces&rdquo;
value in the &ldquo;info&rdquo; dictionary. All other values are decoded as
strings.</p>

<h2>Example</h2>

<pre><code>CL-USER&gt; (ql:quickload &quot;bencode&quot;)
; ...
(&quot;bencode&quot;)
CL-USER&gt; (with-open-file (stream &quot;/tmp/torrent&quot; 
                                 :element-type '(unsigned-byte 8))
           (bencode:decode stream))
#&lt;HASH-TABLE :TEST EQUAL :COUNT 4 {1005E0E3D3}&gt;
CL-USER&gt; (gethash &quot;announce&quot; *)
&quot;http://bttracker.debian.org:6969/announce&quot;
T
CL-USER&gt; (type-of (gethash &quot;pieces&quot; (gethash &quot;info&quot; **)))
(SIMPLE-ARRAY (UNSIGNED-BYTE 8) (88860))
CL-USER&gt; (equalp (ironclad:digest-sequence :sha1 (bencode:encode *** nil))
                 (ironclad:digest-file :sha1 &quot;/tmp/torrent&quot;))
T
CL-USER&gt; (asdf:test-system &quot;bencode&quot;)
......................................
T
CL-USER&gt; 
</code></pre>

<h2>Todo</h2>

<ul>
<li>Documentation</li>
</ul>
