<p>Hinge. A synonym for node.</p>

<p>An evented framework for Common Lisp.
Driven by <a href="http://software.schmorp.de/pkg/libev.html" >libev</a>, like the cool kids.</p>

<p>Check out the <a href="https://github.com/sshirokov/hinge/wiki" >wiki</a> for docs and writeups
and stop by the <code>#hinge</code> channel on <a href="http://freenode.net/irc_servers.shtml" >Freenode</a>
to bug me in real time.</p>

<h2>Requirements</h2>

<h3>System level dependencies</h3>

<ul>
<li><a href="http://software.schmorp.de/pkg/libev.html" >libev</a></li>
<li><a href="http://www.zeromq.org/" >ZeroMQ</a> (2.1.11+)</li>
<li><a href="http://www.sbcl.org/" >SBCL</a> (With thread support)</li>
<li><a href="http://curl.haxx.se/" >curl</a> (Required by <code>make develop</code>)</li>
</ul>

<p><a href="http://ccl.clozure.com/" >CCL</a> is also supported, but SBCL is the
primary development platform, and is favored in the makefiles.</p>

<h3>Dependencies built outside of quicklisp</h3>

<p>These deps are fetched and built with <code>make develop</code></p>

<ul>
<li><a href="https://github.com/sbryant/cl-ev" >cl-ev</a></li>
<li><a href="http://common-lisp.net/project/cffi/" >CFFI</a> (Built from git, to support lisp-zmq)</li>
<li><a href="https://github.com/galdor/lisp-zmq" >lisp-zmq</a></li>
</ul>

<h2>Quickstart</h2>

<p>Clone and init the project</p>

<pre><code># Clone the repo
$ git clone https://github.com/sshirokov/hinge.git
$ cd hinge

# Init the enviornment
$ make develop</code></pre>

<p>Once you run <code>make develop</code> you&apos;re free to use Hinge in other
Lisp systems as long as you don&apos;t relocate the project directory.</p>

<p>Fire up the REPL and evaluate the following.
It should boot up and keep running an HTTP server on port 4545</p>

<pre><code><span class="code"><span class="paren1">(<span class="code">ql:quickload <span class="keyword">:hinge</span></span>)</span>
<span class="paren1">(<span class="code"><i><span class="symbol">defpackage</span></i> <span class="keyword">:hinge-example</span>
  <span class="paren2">(<span class="code"><span class="keyword">:use</span> <span class="keyword">:cl</span> <span class="keyword">:hinge</span> <span class="keyword">:hinge.http</span></span>)</span></span>)</span>

<span class="paren1">(<span class="code">in-package <span class="keyword">:hinge-example</span></span>)</span>

<span class="paren1">(<span class="code"><i><span class="symbol">let</span></i> <span class="paren2">(<span class="code"><span class="paren3">(<span class="code">server <span class="paren4">(<span class="code">make-instance 'http-server</span>)</span></span>)</span></span>)</span>
  <span class="paren2">(<span class="code">add-listener server <span class="string">"request"</span>
                <span class="paren3">(<span class="code"><i><span class="symbol">lambda</span></i> <span class="paren4">(<span class="code">request response</span>)</span>
                  <span class="paren4">(<span class="code">declare <span class="paren5">(<span class="code">ignorable request</span>)</span></span>)</span>
                  <span class="paren4">(<span class="code">write-head response 200 '<span class="paren5">(<span class="code"><span class="paren6">(<span class="code"><span class="string">"Content-Type"</span> . <span class="string">"text/html"</span></span>)</span></span>)</span></span>)</span>
                  <span class="paren4">(<span class="code">end response <span class="string">"Hello world!"</span></span>)</span></span>)</span></span>)</span>

  <span class="paren2">(<span class="code">bind server 4545</span>)</span></span>)</span>

<span class="paren1">(<span class="code">run <span class="keyword">:default</span></span>)</span></span></code></pre>

<p>You should now be able to throw HTTP requests at localhost:4545 with something
like <code>curl</code> and get replies:</p>

<pre><code>$ time curl -i localhost:4545
HTTP/1.1 200 OK
Content-Length: 12
Content-Type: text/html

Hello world!
real    0m0.006s
user    0m0.004s
sys 0m0.000s</code></pre>

<p>You can also throw something like <code>ab</code> at it,
which is somewhat mandatory despite being a poor benchmark:</p>

<pre><code>$ ab -c 10 -n 1000 http://localhost:4545/
This is ApacheBench, Version 2.3 &lt;$Revision: 655654 $&gt;
Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
Licensed to The Apache Software Foundation, http://www.apache.org/

Benchmarking localhost (be patient)
Completed 100 requests
Completed 200 requests
Completed 300 requests
Completed 400 requests
Completed 500 requests
Completed 600 requests
Completed 700 requests
Completed 800 requests
Completed 900 requests
Completed 1000 requests
Finished 1000 requests


Server Software:
Server Hostname:        localhost
Server Port:            4545

Document Path:          /
Document Length:        12 bytes

Concurrency Level:      10
Time taken for tests:   0.397 seconds
Complete requests:      1000
Failed requests:        0
Write errors:           0
Total transferred:      51000 bytes
HTML transferred:       12000 bytes
Requests per second:    2519.51 [#/sec] (mean)
Time per request:       3.969 [ms] (mean)
Time per request:       0.397 [ms] (mean, across all concurrent requests)
Transfer rate:          125.48 [Kbytes/sec] received

Connection Times (ms)
              min  mean[+/-sd] median   max
Connect:        0    0   0.0      0       0
Processing:     2    3   9.7      3     214
Waiting:        1    2   9.6      2     213
Total:          2    3   9.7      3     214

Percentage of the requests served within a certain time (ms)
  50%      3
  66%      3
  75%      3
  80%      3
  90%      3
  95%      3
  98%      4
  99%      5
 100%    214 (longest request)</code></pre>
